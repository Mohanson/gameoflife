<html>

<head>
    <meta charset="utf-8">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.2.0/vue.js"></script>
</head>

<body>
    <svg id="cb" v-bind:width="x * (grid.x + grid.d)" v-bind:height="y * (grid.y + grid.d)">
        <g v-for="ix in x">
            <rect v-bind:width="grid.x" v-bind:height="grid.y" v-bind:x="(ix - 1) * (grid.x + grid.d)" v-bind:y="(iy - 1) * (grid.y + grid.d)"
                v-bind:fill="color.negative" v-for="iy in y"></rect>
            <rect v-bind:width="grid.x" v-bind:height="grid.y" v-bind:x="(ix - 1) * (grid.x + grid.d)" v-bind:y="(iy - 1) * (grid.y + grid.d)"
                v-bind:fill="color.positive" v-for="iy in y" v-bind:style="'opacity:' + get((ix - 1), (iy - 1))"></rect>
        </g>
    </svg>
    <script>
        var cb = new Vue({
            el: '#cb',
            data: {
                x: 20,
                y: 20,
                grid: {
                    x: 10,
                    y: 10,
                    d: 2,
                },
                color: {
                    positive: "#cf6fc1",
                    negative: "#ebedf0"
                },
                pix: []
            },
            methods: {
                c: function (x, y) {
                    return this.x * x + y
                },
                set: function (x, y, v) {
                    Vue.set(this.pix, this.c(x, y), v)
                },
                get: function (x, y) {
                    return this.pix[this.c(x, y)]
                },
                init: function () {
                    for (ix = 0; ix < this.x; ix++) {
                        for (iy = 0; iy < this.y; iy++) {
                            this.set(ix, iy, 0)
                        }
                    }
                    this.set(3, 3, 1)
                    this.set(4, 3, 1)
                    this.set(5, 3, 1)
                    this.set(5, 2, 1)
                    this.set(4, 1, 1)
                },

                bias: function (x, y, dx, dy) {
                    ax = (x + dx) % this.x
                    if (ax < 0) {
                        ax += this.x
                    }
                    ay = (y + dy) % this.y
                    if (ay < 0) {
                        ay += this.y
                    }
                    return [ax, ay]
                },
                sum: function (x, y) {
                    var sum = 0
                    for (dx = -1; dx <= 1; dx++) {
                        for (dy = -1; dy <= 1; dy++) {
                            if (dx == dy && dy == 0) {
                                continue
                            }
                            r = this.bias(x, y, dx, dy)
                            px = r[0]
                            py = r[1]
                            sum += this.pix[this.c(px, py)]
                        }
                    }
                    return sum
                },
                next: function () {
                    npix = this.pix.slice(0)
                    for (iy = 0; iy < this.y; iy++) {
                        for (ix = 0; ix < this.x; ix++) {
                            sum = this.sum(ix, iy)
                            if (sum > 3) {
                                npix[this.c(ix, iy)] = 0
                            } else if (sum == 3) {
                                npix[this.c(ix, iy)] = 1
                            } else if (sum < 2) {
                                npix[this.c(ix, iy)] = 0
                            }
                        }
                    }
                    this.pix = npix
                },
                start: function () {
                    this.ticker = setInterval(cb.next, 200)
                },
                stop: function () {
                    clearInterval(this.ticker)
                },
                clear: function () {
                    for (i = 0; i < this.x * this.y; i++) {
                        Vue.set(this.pix, i, 0)
                    }
                }
            }
        })
        cb.init()
        cb.start()
    </script>
</body>

</html>
