<html>

<head>
    <meta charset="utf-8">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.2.0/vue.js"></script>
</head>

<body>
    <div>
        <svg id="cb" style="display:block; margin:auto" v-bind:width="x * 12" v-bind:height="y * 12">
            <g v-for="ix in x">
                <rect v-bind:width="grid.x" v-bind:height="grid.y" v-bind:x="(ix - 1) * (grid.x + grid.d)" v-bind:y="(iy - 1) * (grid.y + grid.d)"
                    v-bind:fill="pix[c((ix - 1), (iy - 1))] == 1 ? color.positive : color.negative" @mouseover="mouseover((ix-1), (iy-1))"
                    v-for="iy in y"></rect>
            </g>
        </svg>
    </div>
    <script>
        var cb = new Vue({
            el: '#cb',
            data: {
                x: 30,
                y: 30,
                grid: {
                    x: 10,
                    y: 10,
                    d: 2,
                },
                color: {
                    positive: "#cf6fc1",
                    negative: "#ebedf0"
                },
                pix: []
            },
            methods: {
                c: function (x, y) {
                    return this.x * x + y
                },
                bias: function (x, y, dx, dy) {
                    ax = (x + dx) % this.x
                    if (ax < 0) {
                        ax += this.x
                    }
                    ay = (y + dy) % this.y
                    if (ay < 0) {
                        ay += this.y
                    }
                    return [ax, ay]
                },
                sum: function (x, y) {
                    var sum = 0
                    for (dx = -1; dx <= 1; dx++) {
                        for (dy = -1; dy <= 1; dy++) {
                            if (dx == dy && dy == 0) {
                                continue
                            }
                            r = this.bias(x, y, dx, dy)
                            px = r[0]
                            py = r[1]
                            sum += this.pix[this.c(px, py)]
                        }
                    }
                    return sum
                },
                init: function () {
                    for (i = 0; i < this.x * this.y; i++) {
                        Vue.set(this.pix, i, 0)
                    }
                    Vue.set(this.pix, this.c(3, 3), 1)
                    Vue.set(this.pix, this.c(4, 3), 1)
                    Vue.set(this.pix, this.c(5, 3), 1)
                    Vue.set(this.pix, this.c(5, 2), 1)
                    Vue.set(this.pix, this.c(4, 1), 1)
                },
                next: function () {
                    npix = this.pix.slice(0)
                    for (iy = 0; iy < this.y; iy++) {
                        for (ix = 0; ix < this.x; ix++) {
                            sum = this.sum(ix, iy)
                            if (sum > 3) {
                                npix[this.c(ix, iy)] = 0
                            } else if (sum == 3) {
                                npix[this.c(ix, iy)] = 1
                            } else if (sum < 2) {
                                npix[this.c(ix, iy)] = 0
                            }
                        }
                    }
                    this.pix = npix
                },
                mouseover: function (x, y) {
                    Vue.set(this.pix, this.c(x, y), 1)
                }
            }
        })
        window.onload = function () {
            cb.init()
            setInterval(cb.next, 200)
        }()
    </script>
</body>

</html>
